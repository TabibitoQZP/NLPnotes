# LayoutReader

这个项目的贡献有两个

- 构建了一个数据集ReadingBank, 包括50000个文档图片及其对应的阅读顺序, 文本信息以及layout information (老实说这个词就抽象)

- 构建了模型LayoutReader, 用于获取文本以及Layout information, 用于预测阅读顺序

老实说我刚看到这个项目还在想这玩意有啥好做的, 但实际上文档中的阅读顺序确实很重要, 比如论文给出了他们的一些样例

![](https://production-media.paperswithcode.com/datasets/Screenshot_2021-08-31_at_17.06.03.png)

对于大部分论文类型, 传统排版往往没那么多事儿. 然而实际的文档可能会为了好看做一些特别的排版, 同时表格类型也只能一格一格地看. 因此, 做好顺序预测将能够很好地用于下游任务如OCR等.

## 数据集制作

构造其实很简单, 他们用的原始数据不是PDF, 而是WORD文件. 论文介绍到有2种常见的WORD格式, 一种是binary format, 另一种是XML format. 后者会把阅读顺序嵌入XML元数据中, 因此可以很轻易地基于WORD模板生成大量数据集. 当然, 生成后还需要对每个token打标注框, 因此具体的工程细节还是要处理的.

听起来简单但确实非常可行, 但这里提取的东西实际上很多而且很杂. 涉及一些具体细节, 如将DOCX转换成PDF后, bounding box怎么标注之类的. 这里作者他们说这是他们所知的第一个针对阅读顺序的数据集.

具体而言, 原始数据集是一堆XML编码的WORD. 这些WORD通过XML元数据能知道每个token的阅读顺序. 而后我们需要转化其为PDF, 这样能用PDF解析器知道其对应的bounding box. 这两部分是分离的, 如何把这两部分联系起来, 这里用了一个所谓的染色法.

通过解析WORD中的XML元数据, 我们获得了一个文本序列

$$
(w_1,w_2,...,w_n)
$$

而后, 将WORD转化为PDF, 用PDF解析器获得了一堆文本及其对应的bounding box, 如下

$$
\{(w'_1,x_0^1,y_0^1,x_1^1,y_1^1),...,(w'_n,x_0^n,y_0^n,x_1^n,y_1^n)\}
$$

然而, 这样的数据问题在于, 用PDF解析得到的单词都是一个一个的, 且无序. 如何与WORD中获得的$w$匹配呢? 如果$w$之间各不相同, 那么直接用$w$和$w'$做匹配即可, 数据集就构建完了. 但单词显然会有重复出现的, 这种情况下如何匹配?

这里就要用染色法, 假设会给每一个$w$一个对应的appearance index $i$, 代表$w$此前出现过$i$次. 这样, WORD中提取的数据可以改写为

$$
((w_1,i_1),...,(w_n,i_n))
$$

同时, 基于这个$i$, 对每个$w$在WORD文件中进行颜色变换, 变换方案如下

$$
r=i\&0\mathrm{x}110000\\
g=i\&0\mathrm{x}001100\\
b=i\&0\mathrm{x}000011\\
C(i)=(r,g,b)
$$

这样, 转化成PDF后, 会蕴含颜色信息, 如果仔细看前面的$C(i)$就知道这是个双射, 因此在PDF中可以用RGB信息还原出$w'$对应的$i$, 再结合前面WORD提供的序列信息, 这里就能完整标注每个单词的索引了.

## LayoutReader

Paper with Code / 论文上的模型图

![](https://production-media.paperswithcode.com/methods/82f68593-7263-40ea-91b1-1c8f48456c0b.png)

其实是有些模糊的... 实际上应该是一个像attention is all you need中翻译结构, encoder加decoder. 而且实际也没说清楚运作方式, 可以不去细了解.

## 总结

这篇文章的本质是说, 自己提出了这样一个阅读顺序的数据集, 并根据这个数据集指出能得到一个比较合适的模型, 意在表明这个问题是可以被解决的. 至于这个模型本身不需要去理解, 因为本身的设计有诸多不合理性, 比如这里的输入是PDF中的乱序序列编码, 而输出是预测序列, 这本身就不合理, 因为生成序列这种事情, 之前的token可能出现了, 这里没出现, 可能没出现这里又出现了多次. 换言之, 生成的序列并不一定就是输入序列的一个排列, 所以不太合理.